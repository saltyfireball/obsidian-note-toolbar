/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ye=Object.create;var O=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var Ae=Object.getPrototypeOf,Ne=Object.prototype.hasOwnProperty;var be=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Pe=(e,t)=>{for(var o in t)O(e,o,{get:t[o],enumerable:!0})},G=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Te(t))!Ne.call(e,r)&&r!==o&&O(e,r,{get:()=>t[r],enumerable:!(n=he(t,r))||n.enumerable});return e};var ke=(e,t,o)=>(o=e!=null?ye(Ae(e)):{},G(t||!e||!e.__esModule?O(o,"default",{value:e,enumerable:!0}):o,e)),Fe=e=>G(O({},"__esModule",{value:!0}),e);var ue=be(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});var f=require("obsidian"),R="YYYY-MM-DD",U="gggg-[W]ww",J="YYYY-MM",X="YYYY-[Q]Q",Z="YYYY";function F(e){var o,n;let t=window.app.plugins.getPlugin("periodic-notes");return t&&((n=(o=t.settings)==null?void 0:o[e])==null?void 0:n.enabled)}function M(){var e,t,o,n;try{let{internalPlugins:r,plugins:i}=window.app;if(F("daily")){let{format:s,folder:d,template:g}=((t=(e=i.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.daily)||{};return{format:s||R,folder:(d==null?void 0:d.trim())||"",template:(g==null?void 0:g.trim())||""}}let{folder:a,format:c,template:u}=((n=(o=r.getPluginById("daily-notes"))==null?void 0:o.instance)==null?void 0:n.options)||{};return{format:c||R,folder:(a==null?void 0:a.trim())||"",template:(u==null?void 0:u.trim())||""}}catch(r){console.info("No custom daily note settings found!",r)}}function S(){var e,t,o,n,r,i,a;try{let c=window.app.plugins,u=(e=c.getPlugin("calendar"))==null?void 0:e.options,s=(o=(t=c.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:o.weekly;if(F("weekly"))return{format:s.format||U,folder:((n=s.folder)==null?void 0:n.trim())||"",template:((r=s.template)==null?void 0:r.trim())||""};let d=u||{};return{format:d.weeklyNoteFormat||U,folder:((i=d.weeklyNoteFolder)==null?void 0:i.trim())||"",template:((a=d.weeklyNoteTemplate)==null?void 0:a.trim())||""}}catch(c){console.info("No custom weekly note settings found!",c)}}function v(){var t,o,n,r;let e=window.app.plugins;try{let i=F("monthly")&&((o=(t=e.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:o.monthly)||{};return{format:i.format||J,folder:((n=i.folder)==null?void 0:n.trim())||"",template:((r=i.template)==null?void 0:r.trim())||""}}catch(i){console.info("No custom monthly note settings found!",i)}}function _(){var t,o,n,r;let e=window.app.plugins;try{let i=F("quarterly")&&((o=(t=e.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:o.quarterly)||{};return{format:i.format||X,folder:((n=i.folder)==null?void 0:n.trim())||"",template:((r=i.template)==null?void 0:r.trim())||""}}catch(i){console.info("No custom quarterly note settings found!",i)}}function D(){var t,o,n,r;let e=window.app.plugins;try{let i=F("yearly")&&((o=(t=e.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:o.yearly)||{};return{format:i.format||Z,folder:((n=i.folder)==null?void 0:n.trim())||"",template:((r=i.template)==null?void 0:r.trim())||""}}catch(i){console.info("No custom yearly note settings found!",i)}}function ee(...e){let t=[];for(let n=0,r=e.length;n<r;n++)t=t.concat(e[n].split("/"));let o=[];for(let n=0,r=t.length;n<r;n++){let i=t[n];!i||i==="."||o.push(i)}return t[0]===""&&o.unshift(""),o.join("/")}function Me(e){let t=e.substring(e.lastIndexOf("/")+1);return t.lastIndexOf(".")!=-1&&(t=t.substring(0,t.lastIndexOf("."))),t}async function Se(e){let t=e.replace(/\\/g,"/").split("/");if(t.pop(),t.length){let o=ee(...t);window.app.vault.getAbstractFileByPath(o)||await window.app.vault.createFolder(o)}}async function L(e,t){t.endsWith(".md")||(t+=".md");let o=f.normalizePath(ee(e,t));return await Se(o),o}async function b(e){let{metadataCache:t,vault:o}=window.app,n=f.normalizePath(e);if(n==="/")return Promise.resolve(["",null]);try{let r=t.getFirstLinkpathDest(n,""),i=await o.cachedRead(r),a=window.app.foldManager.load(r);return[i,a]}catch(r){return console.error(`Failed to read the daily note template '${n}'`,r),new f.Notice("Failed to read the daily note template"),["",null]}}function T(e,t="day"){let o=e.clone().startOf(t).format();return`${t}-${o}`}function te(e){return e.replace(/\[[^\]]*\]/g,"")}function ve(e,t){if(t==="week"){let o=te(e);return/w{1,2}/i.test(o)&&(/M{1,4}/.test(o)||/D{1,4}/.test(o))}return!1}function P(e,t){return oe(e.basename,t)}function _e(e,t){return oe(Me(e),t)}function oe(e,t){let n={day:M,week:S,month:v,quarter:_,year:D}[t]().format.split("/").pop(),r=window.moment(e,n,!0);if(!r.isValid())return null;if(ve(n,t)&&t==="week"){let i=te(n);if(/w{1,2}/i.test(i))return window.moment(e,n.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return r}var V=class extends Error{};async function ne(e){let t=window.app,{vault:o}=t,n=window.moment,{template:r,format:i,folder:a}=M(),[c,u]=await b(r),s=e.format(i),d=await L(a,s);try{let g=await o.create(d,c.replace(/{{\s*date\s*}}/gi,s).replace(/{{\s*time\s*}}/gi,n().format("HH:mm")).replace(/{{\s*title\s*}}/gi,s).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(h,w,A,y,m,p)=>{let C=n(),B=e.clone().set({hour:C.get("hour"),minute:C.get("minute"),second:C.get("second")});return A&&B.add(parseInt(y,10),m),p?B.format(p.substring(1).trim()):B.format(i)}).replace(/{{\s*yesterday\s*}}/gi,e.clone().subtract(1,"day").format(i)).replace(/{{\s*tomorrow\s*}}/gi,e.clone().add(1,"d").format(i)));return t.foldManager.save(g,u),g}catch(g){console.error(`Failed to create file: '${d}'`,g),new f.Notice("Unable to create new file.")}}function De(e,t){var o;return(o=t[T(e,"day")])!=null?o:null}function Le(){let{vault:e}=window.app,{folder:t}=M(),o=e.getAbstractFileByPath(f.normalizePath(t));if(!o)throw new V("Failed to find daily notes folder");let n={};return f.Vault.recurseChildren(o,r=>{if(r instanceof f.TFile){let i=P(r,"day");if(i){let a=T(i,"day");n[a]=r}}}),n}var q=class extends Error{};function Ee(){let{moment:e}=window,t=e.localeData()._week.dow,o=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;t;)o.push(o.shift()),t--;return o}function Oe(e){return Ee().indexOf(e.toLowerCase())}async function re(e){let{vault:t}=window.app,{template:o,format:n,folder:r}=S(),[i,a]=await b(o),c=e.format(n),u=await L(r,c);try{let s=await t.create(u,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,g,h,w,A,y)=>{let m=window.moment(),p=e.clone().set({hour:m.get("hour"),minute:m.get("minute"),second:m.get("second")});return h&&p.add(parseInt(w,10),A),y?p.format(y.substring(1).trim()):p.format(n)}).replace(/{{\s*title\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(d,g,h)=>{let w=Oe(g);return e.weekday(w).format(h.trim())}));return window.app.foldManager.save(s,a),s}catch(s){console.error(`Failed to create file: '${u}'`,s),new f.Notice("Unable to create new file.")}}function Ie(e,t){var o;return(o=t[T(e,"week")])!=null?o:null}function Ye(){let e={};if(!ae())return e;let{vault:t}=window.app,{folder:o}=S(),n=t.getAbstractFileByPath(f.normalizePath(o));if(!n)throw new q("Failed to find weekly notes folder");return f.Vault.recurseChildren(n,r=>{if(r instanceof f.TFile){let i=P(r,"week");if(i){let a=T(i,"week");e[a]=r}}}),e}var Q=class extends Error{};async function ie(e){let{vault:t}=window.app,{template:o,format:n,folder:r}=v(),[i,a]=await b(o),c=e.format(n),u=await L(r,c);try{let s=await t.create(u,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,g,h,w,A,y)=>{let m=window.moment(),p=e.clone().set({hour:m.get("hour"),minute:m.get("minute"),second:m.get("second")});return h&&p.add(parseInt(w,10),A),y?p.format(y.substring(1).trim()):p.format(n)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(s,a),s}catch(s){console.error(`Failed to create file: '${u}'`,s),new f.Notice("Unable to create new file.")}}function He(e,t){var o;return(o=t[T(e,"month")])!=null?o:null}function xe(){let e={};if(!se())return e;let{vault:t}=window.app,{folder:o}=v(),n=t.getAbstractFileByPath(f.normalizePath(o));if(!n)throw new Q("Failed to find monthly notes folder");return f.Vault.recurseChildren(n,r=>{if(r instanceof f.TFile){let i=P(r,"month");if(i){let a=T(i,"month");e[a]=r}}}),e}var z=class extends Error{};async function We(e){let{vault:t}=window.app,{template:o,format:n,folder:r}=_(),[i,a]=await b(o),c=e.format(n),u=await L(r,c);try{let s=await t.create(u,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,g,h,w,A,y)=>{let m=window.moment(),p=e.clone().set({hour:m.get("hour"),minute:m.get("minute"),second:m.get("second")});return h&&p.add(parseInt(w,10),A),y?p.format(y.substring(1).trim()):p.format(n)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(s,a),s}catch(s){console.error(`Failed to create file: '${u}'`,s),new f.Notice("Unable to create new file.")}}function Ce(e,t){var o;return(o=t[T(e,"quarter")])!=null?o:null}function Be(){let e={};if(!le())return e;let{vault:t}=window.app,{folder:o}=_(),n=t.getAbstractFileByPath(f.normalizePath(o));if(!n)throw new z("Failed to find quarterly notes folder");return f.Vault.recurseChildren(n,r=>{if(r instanceof f.TFile){let i=P(r,"quarter");if(i){let a=T(i,"quarter");e[a]=r}}}),e}var $=class extends Error{};async function Re(e){let{vault:t}=window.app,{template:o,format:n,folder:r}=D(),[i,a]=await b(o),c=e.format(n),u=await L(r,c);try{let s=await t.create(u,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,g,h,w,A,y)=>{let m=window.moment(),p=e.clone().set({hour:m.get("hour"),minute:m.get("minute"),second:m.get("second")});return h&&p.add(parseInt(w,10),A),y?p.format(y.substring(1).trim()):p.format(n)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(s,a),s}catch(s){console.error(`Failed to create file: '${u}'`,s),new f.Notice("Unable to create new file.")}}function Ue(e,t){var o;return(o=t[T(e,"year")])!=null?o:null}function Ve(){let e={};if(!ce())return e;let{vault:t}=window.app,{folder:o}=D(),n=t.getAbstractFileByPath(f.normalizePath(o));if(!n)throw new $("Failed to find yearly notes folder");return f.Vault.recurseChildren(n,r=>{if(r instanceof f.TFile){let i=P(r,"year");if(i){let a=T(i,"year");e[a]=r}}}),e}function qe(){var n,r;let{app:e}=window,t=e.internalPlugins.plugins["daily-notes"];if(t&&t.enabled)return!0;let o=e.plugins.getPlugin("periodic-notes");return o&&((r=(n=o.settings)==null?void 0:n.daily)==null?void 0:r.enabled)}function ae(){var o,n;let{app:e}=window;if(e.plugins.getPlugin("calendar"))return!0;let t=e.plugins.getPlugin("periodic-notes");return t&&((n=(o=t.settings)==null?void 0:o.weekly)==null?void 0:n.enabled)}function se(){var o,n;let{app:e}=window,t=e.plugins.getPlugin("periodic-notes");return t&&((n=(o=t.settings)==null?void 0:o.monthly)==null?void 0:n.enabled)}function le(){var o,n;let{app:e}=window,t=e.plugins.getPlugin("periodic-notes");return t&&((n=(o=t.settings)==null?void 0:o.quarterly)==null?void 0:n.enabled)}function ce(){var o,n;let{app:e}=window,t=e.plugins.getPlugin("periodic-notes");return t&&((n=(o=t.settings)==null?void 0:o.yearly)==null?void 0:n.enabled)}function Qe(e){let t={day:M,week:S,month:v,quarter:_,year:D}[e];return t()}function ze(e,t){return{day:ne,month:ie,week:re}[e](t)}l.DEFAULT_DAILY_NOTE_FORMAT=R;l.DEFAULT_MONTHLY_NOTE_FORMAT=J;l.DEFAULT_QUARTERLY_NOTE_FORMAT=X;l.DEFAULT_WEEKLY_NOTE_FORMAT=U;l.DEFAULT_YEARLY_NOTE_FORMAT=Z;l.appHasDailyNotesPluginLoaded=qe;l.appHasMonthlyNotesPluginLoaded=se;l.appHasQuarterlyNotesPluginLoaded=le;l.appHasWeeklyNotesPluginLoaded=ae;l.appHasYearlyNotesPluginLoaded=ce;l.createDailyNote=ne;l.createMonthlyNote=ie;l.createPeriodicNote=ze;l.createQuarterlyNote=We;l.createWeeklyNote=re;l.createYearlyNote=Re;l.getAllDailyNotes=Le;l.getAllMonthlyNotes=xe;l.getAllQuarterlyNotes=Be;l.getAllWeeklyNotes=Ye;l.getAllYearlyNotes=Ve;l.getDailyNote=De;l.getDailyNoteSettings=M;l.getDateFromFile=P;l.getDateFromPath=_e;l.getDateUID=T;l.getMonthlyNote=He;l.getMonthlyNoteSettings=v;l.getPeriodicNoteSettings=Qe;l.getQuarterlyNote=Ce;l.getQuarterlyNoteSettings=_;l.getTemplateInfo=b;l.getWeeklyNote=Ie;l.getWeeklyNoteSettings=S;l.getYearlyNote=Ue;l.getYearlyNoteSettings=D});var je={};Pe(je,{default:()=>W});module.exports=Fe(je);var E=require("obsidian");var N=require("obsidian");var k=require("obsidian"),I=class extends k.Modal{constructor(t,o,n){super(t),this.editor=o,this.plugin=n||null}onOpen(){var r,i;let{contentEl:t}=this;t.empty(),t.addClass("sf-highlight-helpers-modal"),t.createEl("h2",{text:"Helpers"});let o=(((i=(r=this.editor)==null?void 0:r.getSelection)==null?void 0:i.call(r))||"").trim(),n=t.createDiv("sf-helper-actions");if(o){n.createEl("button",{text:"Wrap selection in inline code"}).addEventListener("click",()=>{let a=this.editor.getSelection();if(!a){new k.Notice("Select some text first");return}this.editor.replaceSelection(`\`${a}\``),this.close()}),n.createEl("button",{text:"Wrap selection in code block"}).addEventListener("click",()=>{let a=this.editor.getSelection();if(!a){new k.Notice("Select some text first");return}let c=["```",a,"```"].filter(u=>u!==void 0).join(`
`);this.editor.replaceSelection(c),this.close()}),window.figletAPI&&n.createEl("button",{text:"Figlet Font (ASCII Art)"}).addEventListener("click",()=>{var a;this.close(),this.plugin&&((a=window.figletAPI)==null||a.openModal(this.app,this.plugin,this.editor))});return}n.createEl("button",{text:"Insert empty code block"}).addEventListener("click",()=>{this.editor.replaceSelection("```\n\n```"),this.close()}),window.figletAPI&&n.createEl("button",{text:"Figlet Font (ASCII Art)"}).addEventListener("click",()=>{var a;this.close(),this.plugin&&((a=window.figletAPI)==null||a.openModal(this.app,this.plugin,this.editor))})}onClose(){this.contentEl.empty()}};var H="data-sf-toolbar";function Y(e){return e?e.buttonEl||e.el||e.element||e:null}function j(e,t,o){typeof e.setAttr=="function"&&e.setAttr(t,o)}function fe(e){let t=typeof e.getState=="function"?e.getState():{};return(typeof e.getMode=="function"?e.getMode():null)!=="preview"&&(t==null?void 0:t.source)===!0}function K(e){let t=e.app.workspace.getActiveViewOfType(N.MarkdownView);if(!t||e.toolbarActionButtons.has(t))return;let o=t.addAction("calendar","Open Today's Note",async()=>{var i;try{let a=await Promise.resolve().then(()=>ke(ue(),1)),c=a.getAllDailyNotes(),u=a.getDailyNote((0,N.moment)(),c);if(!u){new N.Notice("Today's Daily Note was not found.");return}let s=e.app.workspace,d=(i=s.activeLeaf)!=null?i:null;if(de(d,u))return;let g=s.getLeavesOfType("markdown").find(w=>w!==d&&de(w,u));if(g){s.setActiveLeaf(g,{focus:!0});return}await(d!=null?d:s.getLeaf(!1)).openFile(u)}catch(a){console.error("Failed to open today's Daily Note",a),new N.Notice("Unable to open today's Daily Note.")}}),n=t.addAction("wand","Helpers",()=>{new I(e.app,t.editor,e).open()}),r=me(e,t,"code-2","Switch to Source");j(o,H,"today"),j(n,H,"helpers"),e.toolbarActionButtons.set(t,{today:o,helpers:n,sourceToggle:r}),ge(e,t),x(e,t)}function pe(e){e.app.workspace.iterateAllLeaves(t=>{let o=t.view;!o||typeof o.getViewType!="function"||o.getViewType()==="markdown"&&$e(e,o)})}function x(e,t){if(!t)return;let o=e.toolbarActionButtons.get(t);if(!o)return;let n=fe(t),r=n?"Switch to Live Preview":"Switch to Source",i=n?"eye":"code-2",a=o.sourceToggle,c=!a||a.__sfIcon!==i,u=!a||a.__sfTitle!==r;if(!c){u&&a&&typeof a.setTitle=="function"&&(a.setTitle(r),a.__sfTitle=r);return}we(a);let s=me(e,t,i,r);e.toolbarActionButtons.set(t,{...o,sourceToggle:s}),ge(e,t)}function ge(e,t){let o=e.toolbarActionButtons.get(t);if(!o)return;let n=Y(o.today),r=Y(o.helpers),i=Y(o.sourceToggle),a=(n==null?void 0:n.parentNode)||(r==null?void 0:r.parentNode)||(i==null?void 0:i.parentNode);if(!n||!r||!i||!a)return;let u=Array.from(a.children).find(s=>{var d;return((d=s.classList)==null?void 0:d.contains("view-action"))&&!s.hasAttribute(H)});a.insertBefore(n,u||null),a.insertBefore(r,u||null),a.insertBefore(i,u||null)}function me(e,t,o,n){let r=t.addAction(o,n,()=>{let i=fe(t),c={...typeof t.getState=="function"?t.getState():{},mode:"source",source:!i};t.setState(c,{history:!1}),typeof t.setEphemeralState=="function"&&t.setEphemeralState({source:c.source}),setTimeout(()=>{x(e,t)},100)});return j(r,H,"source"),typeof r.setTitle=="function"&&r.setTitle(n),r.__sfIcon=o,r.__sfTitle=n,r}function $e(e,t){let o=e.toolbarActionButtons.get(t);o&&(Object.values(o).filter(Boolean).forEach(n=>we(n)),e.toolbarActionButtons.delete(t))}function we(e){if(!e)return;if(typeof e.remove=="function"){e.remove();return}let t=Y(e);t&&typeof t.remove=="function"&&t.remove()}function de(e,t){var o;return!e||!(e.view instanceof N.MarkdownView)?!1:((o=e.view.file)==null?void 0:o.path)===t.path}var W=class extends E.Plugin{constructor(){super(...arguments);this.toolbarActionButtons=new WeakMap;this.sourceModeState=!1}async onload(){K(this),this.updateSourceModeClass();let o=null;this.registerEvent(this.app.workspace.on("layout-change",()=>{o&&clearTimeout(o),o=setTimeout(()=>{o=null,this.updateSourceModeClass(),this.refreshActiveMarkdownPreview()},50)}));let n=null;this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{n&&clearTimeout(n),n=setTimeout(()=>{n=null,K(this),this.updateSourceModeClass(),this.refreshActiveMarkdownPreview()},30)})),this.register(()=>{o&&clearTimeout(o),n&&clearTimeout(n),pe(this)})}updateSourceModeClass(){let o=this.app.workspace.getActiveViewOfType(E.MarkdownView),n=o!=null&&o.getMode?o.getMode():null,r=o!=null&&o.getState?o.getState():null,i=n!=="preview"&&(r==null?void 0:r.source)===!0;i!==this.sourceModeState&&(this.sourceModeState=i,document.body.classList.toggle("sf-source-mode",i)),x(this,o)}refreshActiveMarkdownPreview(){let o=this.app.workspace.getActiveViewOfType(E.MarkdownView);!o||!o.previewMode||o.getMode&&o.getMode()!=="preview"||typeof o.previewMode.rerender=="function"&&o.previewMode.rerender(!0)}};
